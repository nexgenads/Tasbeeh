<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡¶§‡¶æ‡¶∏‡¶¨‡¶ø‡¶π ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‚Ä¢ Tasbeeh Counter</title>
  <meta name="description" content="‡¶è‡¶ï‡¶¶‡¶Æ ‡¶∏‡¶π‡¶ú, ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§, ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶§‡¶æ‡¶∏‡¶¨‡¶ø‡¶π ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡•§ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü‚Äî‡¶∏‡¶¨ ‡¶°‡ßá‡¶ü‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶á ‡¶∏‡ßá‡¶≠ ‡¶•‡¶æ‡¶ï‡ßá‡•§" />
  <meta name="theme-color" content="#059669" />

  <!-- Favicon (inline SVG, no assets needed) -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Cdefs/%3E%3Ccircle cx='32' cy='32' r='28' fill='%2310b981'/%3E%3Ccircle cx='32' cy='12' r='4' fill='white'/%3E%3Ccircle cx='46' cy='18' r='4' fill='white'/%3E%3Ccircle cx='52' cy='32' r='4' fill='white'/%3E%3Ccircle cx='46' cy='46' r='4' fill='white'/%3E%3Ccircle cx='32' cy='52' r='4' fill='white'/%3E%3Ccircle cx='18' cy='46' r='4' fill='white'/%3E%3Ccircle cx='12' cy='32' r='4' fill='white'/%3E%3Ccircle cx='18' cy='18' r='4' fill='white'/%3E%3C/svg%3E" />

  <!-- Inter font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ["Inter", "ui-sans-serif", "system-ui", "-apple-system", "Segoe UI", "Roboto", "Noto Sans", "Ubuntu", "Cantarell", "Arial", "sans-serif"] },
          boxShadow: {
            glow: "0 10px 25px -5px rgba(16,185,129,0.35), 0 8px 10px -6px rgba(16,185,129,0.3)",
          }
        }
      },
      darkMode: 'media'
    }
  </script>
  <style>
    html, body { height: 100%; }
  </style>
</head>
<body class="font-sans antialiased min-h-screen bg-gradient-to-br from-emerald-500 via-teal-500 to-cyan-600 dark:from-slate-950 dark:via-slate-950 dark:to-slate-900 selection:bg-emerald-200/60 selection:text-emerald-900">
  <main class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md">
      <section aria-label="Tasbeeh Counter Card" class="relative rounded-3xl border border-white/20 dark:border-white/10 bg-white/80 dark:bg-white/5 backdrop-blur-lg shadow-2xl">
        <!-- Header -->
        <div class="flex items-center justify-between p-5 sm:p-7 border-b border-black/5 dark:border-white/10">
          <div class="flex items-center gap-3">
            <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-emerald-600 text-white shadow-glow" aria-hidden="true">Ô∑Ω</span>
            <div>
              <h1 class="text-lg sm:text-xl font-bold tracking-tight text-slate-900 dark:text-white">‡¶§‡¶æ‡¶∏‡¶¨‡¶ø‡¶π ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞</h1>
              <p class="text-xs text-slate-600/90 dark:text-slate-300/80">‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü ‚Äî ‡¶ï‡ßã‡¶®‡¶ì ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶®‡ßá‡¶á</p>
            </div>
          </div>
        </div>

        <!-- Body -->
        <div class="p-6 sm:p-8">
          <!-- Label -->
          <label class="block text-sm font-medium text-slate-700 dark:text-slate-200" for="labelInput">‡¶Ø‡¶ø‡¶ï‡¶ø‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ (‡¶ê‡¶ö‡ßç‡¶õ‡¶ø‡¶ï)</label>
          <input id="labelInput" type="text" inputmode="text" placeholder="‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶∏‡ßÅ‡¶¨‡¶π‡¶æ‡¶®‡¶æ‡¶≤‡ßç‡¶≤‡¶æ‡¶π" class="mt-2 w-full rounded-xl border border-slate-300/80 dark:border-white/10 bg-white/80 dark:bg-white/5 px-3 py-2 text-slate-900 dark:text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-emerald-300/70" />

          <!-- Count display -->
          <div class="mt-6 text-center">
            <div id="count" class="text-7xl sm:text-8xl font-bold tracking-tight text-slate-900 dark:text-white tabular-nums select-none" aria-live="polite" aria-atomic="true">0</div>
            <p class="mt-2 text-xs text-slate-600/90 dark:text-slate-300/80">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ <kbd class="px-1.5 py-0.5 rounded bg-slate-900/5 dark:bg-white/10 text-[11px]">Space</kbd> ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®</p>
            <div id="roundsWrap" class="mt-1 text-xs text-slate-700 dark:text-slate-300 hidden"><span>‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶°: </span><span id="rounds">0</span></div>
          </div>

          <!-- Progress to target -->
          <div id="progressWrap" class="mt-5 hidden">
            <div class="flex items-center justify-between text-xs text-slate-600 dark:text-slate-300">
              <span id="progressLabel">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø</span>
              <span id="progressText">0 / 0</span>
            </div>
            <div class="mt-2 h-2 w-full rounded-full bg-slate-200/70 dark:bg-white/10">
              <div id="progressBar" class="h-2 rounded-full bg-emerald-500" style="width:0%"></div>
            </div>
          </div>

          <!-- Main count button -->
          <div class="mt-6 flex justify-center">
            <button id="countBtn" type="button" class="group w-48 h-48 sm:w-56 sm:h-56 rounded-full bg-emerald-600 text-white text-2xl sm:text-3xl font-semibold shadow-glow ring-1 ring-black/5 focus:outline-none focus-visible:ring-4 focus-visible:ring-emerald-300 dark:focus-visible:ring-emerald-500/60 active:scale-95 transition-transform duration-100 relative">
              <span class="pointer-events-none">‡¶ó‡¶£‡¶æ</span>
              <span class="absolute inset-0 rounded-full border-2 border-white/20 group-active:scale-110 transition-transform duration-200"></span>
            </button>
          </div>

          <!-- Actions -->
          <div class="mt-6 grid grid-cols-2 gap-3">
            <button id="resetBtn" type="button" class="px-4 py-2 rounded-xl border border-slate-300/70 dark:border-white/10 bg-white/70 dark:bg-white/5 text-slate-800 dark:text-slate-200 hover:bg-white/90 dark:hover:bg-white/10 focus:outline-none focus-visible:ring-4 focus-visible:ring-rose-300/60 text-sm font-semibold">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
            <button id="soundToggle" type="button" class="px-4 py-2 rounded-xl border border-slate-300/70 dark:border-white/10 bg-white/70 dark:bg-white/5 text-slate-800 dark:text-slate-200 hover:bg-white/90 dark:hover:bg-white/10 focus:outline-none focus-visible:ring-4 focus-visible:ring-emerald-300/60 text-sm font-semibold flex items-center justify-center gap-2">
              <span id="soundStatus">‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ‡¶¨‡¶®‡ßç‡¶ß</span>
            </button>
          </div>

          <!-- Target selector -->
          <div class="mt-6">
            <p class="text-xs font-medium text-slate-700 dark:text-slate-200 mb-2">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</p>
            <div class="flex flex-wrap items-center gap-2">
              <button data-target="0" class="targetBtn px-3 py-1.5 rounded-lg bg-white/80 dark:bg-white/5 border border-slate-300/70 dark:border-white/10 text-sm text-slate-800 dark:text-slate-200 hover:bg-white/90">No target</button>
              <button data-target="33" class="targetBtn px-3 py-1.5 rounded-lg bg-white/80 dark:bg-white/5 border border-slate-300/70 dark:border-white/10 text-sm text-slate-800 dark:text-slate-200 hover:bg-white/90">33</button>
              <button data-target="99" class="targetBtn px-3 py-1.5 rounded-lg bg-white/80 dark:bg-white/5 border border-slate-300/70 dark:border-white/10 text-sm text-slate-800 dark:text-slate-200 hover:bg-white/90">99</button>
              <div class="flex items-center gap-2">
                <input id="customTarget" type="number" min="1" placeholder="Custom" class="w-24 rounded-lg border border-slate-300/70 dark:border-white/10 bg-white/80 dark:bg-white/5 px-3 py-1.5 text-sm text-slate-900 dark:text-white focus:outline-none focus-visible:ring-4 focus-visible:ring-emerald-300/70" />
                <button id="setCustomTarget" class="px-3 py-1.5 rounded-lg bg-emerald-600 text-white text-sm font-semibold hover:bg-emerald-500">Set</button>
              </div>
            </div>
          </div>

          <!-- Tips -->
          <p class="mt-5 text-center text-xs text-slate-500 dark:text-slate-400">‡¶∂‡¶∞‡ßç‡¶ü‡¶ï‡¶æ‡¶ü: <kbd class="px-1.5 py-0.5 rounded bg-slate-900/5 dark:bg-white/10 text-[11px]">Space</kbd> = ‡¶ó‡¶£‡¶æ, <kbd class="px-1.5 py-0.5 rounded bg-slate-900/5 dark:bg-white/10 text-[11px]">R</kbd> = ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</p>
        </div>
      </section>

      <footer class="mt-4 text-center text-[11px] text-white/90">
        <span>¬© <span id="year"></span> Tasbeeh Counter ‚Ä¢ GitHub Pages ready</span>
      </footer>
    </div>
  </main>

  <!-- Reset confirm modal -->
  <div id="modal" class="fixed inset-0 z-50 hidden items-center justify-center p-4">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-[2px]"></div>
    <div role="dialog" aria-modal="true" aria-labelledby="modalTitle" class="relative w-full max-w-sm rounded-2xl bg-white dark:bg-slate-900 border border-white/20 dark:border-white/10 shadow-2xl p-6">
      <h2 id="modalTitle" class="text-lg font-semibold text-slate-900 dark:text-white">‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶®?</h2>
      <p class="mt-1 text-sm text-slate-600 dark:text-slate-300">‡¶∏‡¶¨ ‡¶ó‡¶£‡¶®‡¶æ <strong>‡ß¶</strong> ‡¶π‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü/‡¶≤‡ßá‡¶¨‡ßá‡¶≤ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§</p>
      <div class="mt-5 flex justify-end gap-2">
        <button id="cancelReset" class="px-4 py-2 rounded-xl border border-slate-300/70 dark:border-white/10 bg-white/70 dark:bg-white/5 text-slate-800 dark:text-slate-200 hover:bg-white/90 dark:hover:bg-white/10 focus:outline-none focus-visible:ring-4 focus-visible:ring-slate-300/60 text-sm font-semibold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
        <button id="confirmReset" class="px-4 py-2 rounded-xl bg-rose-600 hover:bg-rose-500 text-white shadow-lg focus:outline-none focus-visible:ring-4 focus-visible:ring-rose-300/60 text-sm font-semibold">‡¶π‡ßç‡¶Ø‡¶æ‡¶Å, ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed inset-x-0 top-3 z-[60] mx-auto hidden w-fit rounded-xl bg-emerald-600 text-white px-4 py-2 shadow-xl">‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! üéâ</div>

  <script>
    (function() {
      const STORAGE = {
        COUNT: 'tasbeeh-count-v1',
        LABEL: 'tasbeeh-label-v1',
        TARGET: 'tasbeeh-target-v1',
        SOUND: 'tasbeeh-sound-v1',
        ROUNDS: 'tasbeeh-rounds-v1'
      };

      const $ = (id) => document.getElementById(id);
      const countEl = $('count');
      const countBtn = $('countBtn');
      const resetBtn = $('resetBtn');
      const modal = $('modal');
      const cancelReset = $('cancelReset');
      const confirmReset = $('confirmReset');
      const yearEl = $('year');
      const labelInput = $('labelInput');
      const progressWrap = $('progressWrap');
      const progressBar = $('progressBar');
      const progressText = $('progressText');
      const roundsWrap = $('roundsWrap');
      const roundsEl = $('rounds');
      const soundToggle = $('soundToggle');
      const soundStatus = $('soundStatus');
      const customTarget = $('customTarget');
      const setCustomTarget = $('setCustomTarget');
      const toast = $('toast');

      const targetButtons = Array.from(document.querySelectorAll('.targetBtn'));

      let memoryFallback = { count: 0, label: '', target: 0, sound: false, rounds: 0 };

      const canStore = () => {
        try { localStorage.setItem('__t__','1'); localStorage.removeItem('__t__'); return true; } catch (_) { return false; }
      };

      const get = (key, def) => canStore() ? (JSON.parse(localStorage.getItem(key)) ?? def) : (memoryFallback[key.toLowerCase()] ?? def);
      const set = (key, val) => { if (canStore()) localStorage.setItem(key, JSON.stringify(val)); else memoryFallback[key.toLowerCase()] = val; };

      const getCount = () => get(STORAGE.COUNT, 0);
      const setCount = (v) => { set(STORAGE.COUNT, v); renderCount(v); updateProgress(); };
      const getLabel = () => get(STORAGE.LABEL, '');
      const setLabel = (v) => { set(STORAGE.LABEL, v); };
      const getTarget = () => get(STORAGE.TARGET, 0);
      const setTarget = (v) => { set(STORAGE.TARGET, v); updateProgress(); };
      const getSound = () => get(STORAGE.SOUND, false);
      const setSound = (v) => { set(STORAGE.SOUND, v); renderSound(v); };
      const getRounds = () => get(STORAGE.ROUNDS, 0);
      const setRounds = (v) => { set(STORAGE.ROUNDS, v); renderRounds(v); };

      const renderCount = (val) => {
        countEl.textContent = String(val);
        countEl.animate([{ transform:'scale(1)' },{ transform:'scale(1.06)' },{ transform:'scale(1)'}], { duration: 130, easing: 'ease-out' });
      };
      const renderSound = (on) => { soundStatus.textContent = on ? '‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ‡¶ö‡¶æ‡¶≤‡ßÅ' : '‡¶∏‡¶æ‡¶â‡¶®‡ßç‡¶°: ‡¶¨‡¶®‡ßç‡¶ß'; };
      const renderRounds = (n) => { roundsEl.textContent = String(n); roundsWrap.classList.toggle('hidden', n === 0); };

      // simple beep (no assets)
      const beep = (freq = 660, ms = 45, vol = 0.03) => {
        if (!getSound()) return;
        try {
          const ac = new (window.AudioContext || window.webkitAudioContext)();
          const osc = ac.createOscillator();
          const gain = ac.createGain();
          osc.type = 'sine';
          osc.frequency.value = freq;
          gain.gain.value = vol;
          osc.connect(gain).connect(ac.destination);
          osc.start();
          setTimeout(() => { osc.stop(); ac.close(); }, ms);
        } catch(_) {}
      };

      const showToast = (msg) => {
        toast.textContent = msg;
        toast.classList.remove('hidden');
        toast.animate([{transform:'translateY(-10px)',opacity:0},{transform:'translateY(0)',opacity:1}],{duration:160,easing:'ease-out'});
        setTimeout(() => {
          toast.animate([{opacity:1},{opacity:0}],{duration:180,easing:'ease-in'}).onfinish = () => toast.classList.add('hidden');
        }, 1000);
      };

      const updateProgress = () => {
        const tgt = Number(getTarget());
        const c = Number(getCount());
        if (!tgt || tgt <= 0) { progressWrap.classList.add('hidden'); return; }
        const pct = Math.min(100, Math.floor((c % tgt) / tgt * 100));
        progressWrap.classList.remove('hidden');
        progressBar.style.width = pct + '%';
        progressText.textContent = `${c % tgt} / ${tgt}`;
      };

      const onCount = () => {
        const next = getCount() + 1;
        setCount(next);
        if (navigator.vibrate) navigator.vibrate(10);
        beep(660, 40, 0.03);

        const tgt = Number(getTarget());
        if (tgt > 0 && next % tgt === 0) {
          // completed a round
          setRounds(getRounds() + 1);
          beep(440, 120, 0.05);
          if (navigator.vibrate) navigator.vibrate([30, 40, 30]);
          showToast('‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! üéâ');
        }
      };

      const init = () => {
        yearEl.textContent = new Date().getFullYear();
        renderCount(getCount());
        labelInput.value = getLabel();
        renderSound(getSound());
        renderRounds(getRounds());
        updateProgress();
      };

      // Events
      countBtn.addEventListener('click', onCount);

      resetBtn.addEventListener('click', () => modal.classList.remove('hidden'));
      cancelReset.addEventListener('click', () => modal.classList.add('hidden'));
      confirmReset.addEventListener('click', () => {
        setCount(0);
        setRounds(0);
        modal.classList.add('hidden');
      });

      soundToggle.addEventListener('click', () => setSound(!getSound()));

      labelInput.addEventListener('input', (e) => setLabel(e.target.value || ''));

      targetButtons.forEach(btn => btn.addEventListener('click', () => {
        const v = Number(btn.getAttribute('data-target')) || 0;
        setTarget(v);
        updateProgress();
      }));

      setCustomTarget.addEventListener('click', () => {
        const v = Math.max(1, Number(customTarget.value || '0'));
        setTarget(v);
        updateProgress();
        showToast('Custom ‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü ‡¶∏‡ßá‡¶ü ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá');
      });

      // Keyboard shortcuts
      window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.key === ' ') { e.preventDefault(); onCount(); }
        if (e.key === 'Enter' && (document.activeElement === countBtn || document.activeElement === document.body)) { e.preventDefault(); onCount(); }
        if (e.key === 'r' || e.key === 'R') { modal.classList.remove('hidden'); }
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) { modal.classList.add('hidden'); }
      }, { passive: false });

      init();
    })();
  </script>
</body>
</html>
